<!DOCTYPE html>
<html>
<head>
	<title>JS + CSS Clock</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div id="draw_window">
		<div id="system_clock">
			<img class="clock" id="clock_hour" src="images/clock_hour.png" alt="clock_hour">
			<img class="clock" id="clock_sec" src="images/clock_sec.png" alt="clock_hour">
			<img class="clock" id="clock_min" src="images/clock_min.png" alt="clock_hour">
			<span>System time</span>
		</div>

		<div id="add_watch">
			<p id="plus_text">Add new watch</p>
			<img id="plus_icon" src="images/plus_icon.png" onclick="addWatch()"> 
		</div>
	</div>

	<script type="text/javascript">
		// GET запрос к API если array empty, то добавление часов disabled;

		var timezoneArr;

		makeRequest();

		var interval = 0;
		var clock_sec = document.getElementById("clock_sec");
		var clock_min = document.getElementById("clock_min");
		var clock_hour = document.getElementById("clock_hour");
		var drawWindow = document.getElementById("draw_window");
		var add_watch_btn = document.getElementById("add_watch");

		var watches_count = 1;

		var prev_min;
		var prev_hour;

		startLoop();
		function startLoop() {
			if (interval > 0) clearInterval(interval);
			interval = setInterval("nextArrowsPosition()", 1000);
		}

		function nextArrowsPosition() {
			var cur_secs = new Date().getSeconds();
			var cur_mins = new Date().getMinutes();
			var cur_hours = new Date().getHours();

			if (cur_secs != 0 || cur_secs != 60) {
				clock_sec.style.transform = "rotate(" + cur_secs * 6 + "deg)";
				clock_sec.style.transition = "transform 0.01s";
			}

			if (cur_mins != prev_min || cur_mins != 0 || cur_mins != 60) {
				clock_min.style.transform = "rotate(" + cur_mins * 6 + "deg)";
				clock_min.style.transition = "transform 0.5s";
				prev_min = cur_mins;
			}

			if (cur_hours != prev_hour || cur_hours != 0 || cur_hours != 60) {
				clock_hour.style.transform = "rotate(" + cur_hours * (30 + (cur_mins/60)) + "deg)";
				clock_hour.style.transition = "transform 1s";
				prev_hour = cur_hours;
			}
		}

		function addWatch() {
			var drawWindowWidth = drawWindow.offsetWidth;
			draw_window.style.width = drawWindowWidth + 250 +"px";
			draw_window.style.margin = "-150px 0 0 -" + drawWindow.offsetWidth / 2 + "px";

			var clockDiv = document.createElement('div');
			clockDiv.className = 'new_Clock';
			clockDiv.style.float = 'right';
			clockDiv.style.position = 'relative';

			var clockImg = document.createElement('img');
			clockImg.className = 'clock';
			clockImg.addClass = "noselect";
			clockImg.src = "images/clock_hour.png";

			var form = document.createElement('form');
			form.className = "timezone_form";
			form.action = "#";
			
			var inputList = document.createElement("input");
			inputList.name = "timezone";

			var dataList = document.createElement("dataList");
			dataList.id = "timezones";

			inputList.setAttribute('list', dataList.id);

			var options = '';
			for (i = 0; i < timezoneArr.length; i++) {
					options += '<option value=' + timezoneArr[i] + '/>';
			}

			console.log(timezoneArr.length);

			dataList.innerHTML = options;


			form.appendChild(inputList);
			form.appendChild(dataList);

			clockDiv.appendChild(clockImg);
			clockDiv.appendChild(form);
			
			drawWindow.appendChild(clockDiv);

			watches_count++;
			if (watches_count == 5) {
				add_watch_btn.style.display = "none";
			}
		}


		function makeRequest() {
			var xmlhttp = new XMLHttpRequest();
			var url = "http://worldtimeapi.org/api/timezone";

			var jsonArray = xmlhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var arr = JSON.parse(this.responseText);
					setTimezones(arr);
				}
			}
			xmlhttp.open("GET", url, true);
			xmlhttp.send();

			return jsonArray;
		}

		function setTimezones(zones) {
			timezoneArr = zones;
		}

	</script>
</body>
</html>